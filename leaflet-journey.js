(function() {
    'use strict';

    // Steps
    var routes = [
        {
            // From Paris to Nantes
            route: [[48.8588, 2.3470], [47.2383, -1.5603]],
            transportation: 'train',
            speed: 140,
            distance: 300,
            interval: 1500
        }, {
            // From Nantes to Lyon
            route: [[47.2383, -1.5603], [45.7577, 4.8350]],
            transportation: 'train',
            speed: 205,
            distance: 300,
            interval: 1500
        }, {
            // From Lyon to Vallon-Pont-D'arc
            route: [[45.76031,4.86104],[45.73629,4.85298],[45.68579,4.86094],[45.63962,4.85704],[45.59955,4.85192],[45.58072,4.858],[45.54329,4.86659],[45.5065,4.85192],[45.4874,4.83184],[45.45922,4.8254],[45.40142,4.80923],[45.36655,4.80002],[45.3239,4.80726],[45.29055,4.81375],[45.24011,4.81982],[45.18414,4.81379],[45.139,4.81676],[45.06797,4.84623],[45.00935,4.86962],[44.96579,4.88377],[44.95428,4.88137],[44.92594,4.88198],[44.90407,4.87867],[44.87296,4.86575],[44.84421,4.86338],[44.76216,4.83842],[44.73968,4.80754],[44.68088,4.79375],[44.58236,4.75259],[44.55728,4.72874],[44.55158,4.68537],[44.56181,4.65187],[44.56618,4.60937],[44.55226,4.59249],[44.52726,4.58319],[44.50124,4.57439],[44.49728,4.59777],[44.49849,4.62616],[44.48641,4.61419],[44.47651,4.60179],[44.46832,4.59728],[44.45906,4.59181],[44.45062,4.56909],[44.43977,4.55643],[44.43108,4.53416],[44.40452,4.51318],[44.39046,4.48833],[44.39547,4.47204],[44.38834,4.45184],[44.38331,4.4425],[44.38309,4.41743],[44.38765,4.40844],[44.39867,4.39558]],
            transportation: 'bike',
            speed: 40,
            distance: 6000,
            interval: 100
        }, {
            // From Vallon-Pont-D'arc to Montpellier
            route: [[44.39881,4.39288],[44.38086,4.37314],[44.33239,4.35809],[44.29618,4.33734],[44.25107,4.28955],[44.23204,4.28125],[44.21029,4.25531],[44.1783,4.23541],[44.14933,4.21765],[44.14015,4.18478],[44.11377,4.15492],[44.09642,4.15111],[44.06509,4.14301],[44.05228,4.14314],[44.01548,4.1329],[43.98907,4.11282],[43.95328,4.10071],[43.90223,4.10469],[43.87019,4.09909],[43.83467,4.09591],[43.80506,4.09047],[43.78455,4.08543],[43.76557,4.08323],[43.73453,4.05201],[43.69019,4.00284],[43.67023,3.97695],[43.65241,3.96147],[43.6364,3.92649],[43.62722,3.89836],[43.60922,3.88025]],
            transportation: 'bike',
            speed: 40,
            distance: 5000,
            interval: 100
        }, {
            // From Montpellier to Bayonne
            route: [[43.60481,3.88061],[43.59758,3.83982],[43.59345,3.82086],[43.586,3.78852],[43.57757,3.75326],[43.56024,3.72839],[43.53922,3.72516],[43.51741,3.72034],[43.49557,3.70956],[43.47246,3.67983],[43.44996,3.64469],[43.43631,3.60917],[43.42557,3.57969],[43.41801,3.53555],[43.40037,3.48444],[43.37377,3.46566],[43.35846,3.43905],[43.35302,3.41747],[43.33862,3.39415],[43.31933,3.36617],[43.31619,3.33459],[43.32173,3.26834],[43.33532,3.21435],[43.3169,3.18363],[43.29522,3.13706],[43.28453,3.0707],[43.28408,3.05075],[43.27908,3.00987],[43.26128,2.95661],[43.26283,2.91749],[43.25012,2.90285],[43.24623,2.84994],[43.23887,2.77952],[43.22878,2.71267],[43.2216,2.66344],[43.21628,2.59804],[43.2063,2.55483],[43.19499,2.4952],[43.20921,2.44211],[43.20729,2.384],[43.21215,2.33005],[43.23929,2.21857],[43.25812,2.12058],[43.28051,2.04997],[43.29794,1.99208],[43.31294,1.95564],[43.31806,1.93607],[43.32698,1.87846],[43.34349,1.82843],[43.36412,1.76844],[43.39098,1.71345],[43.39806,1.6803],[43.41853,1.64139],[43.44521,1.60553],[43.46745,1.5629],[43.49821,1.53247],[43.52636,1.51436],[43.55082,1.48224],[43.58165,1.46272],[43.61341,1.45103],[43.63512,1.42165],[43.7195,1.38154],[43.80385,1.32374],[43.84399,1.28995],[43.92145,1.25841],[43.95955,1.23649],[44.02284,1.1639],[44.06384,1.10209],[44.10076,1.07807],[44.08418,0.98475],[44.10525,0.8875],[44.13135,0.82576],[44.14388,0.77844],[44.17104,0.68431],[44.20179,0.64307],[44.20934,0.62146],[44.21299,0.56385],[44.21111,0.52977],[44.21978,0.37878],[44.22967,0.34287],[44.24792,0.30333],[44.23188,0.25403],[44.19312,0.03155],[44.18726,-0.12929],[44.13999,-0.47955],[44.10435,-0.54505],[44.08256,-0.71816],[44.07184,-0.78126],[44.05054,-0.86062],[44.02583,-0.89023],[44.02432,-0.92401],[43.98753,-1.0382],[43.96898,-1.06153],[43.9347,-1.0954],[43.91758,-1.21028],[43.88482,-1.29869],[43.87176,-1.30184],[43.79711,-1.38314],[43.73998,-1.4095],[43.71322,-1.41982],[43.69671,-1.42534],[43.66737,-1.41942],[43.65819,-1.42719],[43.64211,-1.43045],[43.62066,-1.4434],[43.59827,-1.46017],[43.57436,-1.46262],[43.56083,-1.46816],[43.55109,-1.47836],[43.53643,-1.4857],[43.51248,-1.48876],[43.49897,-1.48177]],
            transportation: 'bike',
            speed: 40,
            distance: 5000,
            interval: 100
        }, {
            // From Bayonne to Chambéry
            route: [[43.4844, -1.4612], [45.5823, 5.9064]],
            transportation: 'train',
            speed: 240,
            distance: 300,
            interval: 1500
        }, {
            // From Chambéry to Paris
            route: [[45.5823, 5.9064], [48.8588, 2.3470]],
            transportation: 'car',
            speed: 180,
            distance: 300,
            interval: 1500
        }, {
            // From Paris to Munich
            route: [[48.8588, 2.3470], [48.1550, 11.5418]],
            transportation: 'plane',
            speed: 280,
            distance: 300,
            interval: 1500
        }, {
            // From Munich to Liberec
            route: [[48.1550, 11.5418], [50.7662, 15.0499]],
            transportation: 'train',
            speed: 160,
            distance: 300,
            interval: 1500
        }, {
            // From Liberec to Prague
            route: [[50.7662, 15.0499], [50.0598, 14.4656]],
            transportation: 'train',
            speed: 40,
            distance: 300,
            interval: 1500
        }, {
            // From Prague to Paris
            route: [[50.0598, 14.4656], [48.8588, 2.3470]],
            transportation: 'plane',
            speed: 370,
            distance: 300,
            interval: 1500
        }
    ];

    // Icons
    var bikeIcon = L.icon({
        iconUrl: 'images/marker-bike.png',
        iconSize: [45, 45],
        iconAnchor: [24, 43],
        shadowUrl: null
    });
    var carIcon = L.icon({
        iconUrl: 'images/marker-car.png',
        iconSize: [45, 45],
        iconAnchor: [24, 43],
        shadowUrl: null
    });
    var planeIcon = L.icon({
        iconUrl: 'images/marker-plane.png',
        iconSize: [45, 45],
        iconAnchor: [24, 43],
        shadowUrl: null
    });
    var trainIcon = L.icon({
        iconUrl: 'images/marker-train.png',
        iconSize: [45, 45],
        iconAnchor: [24, 43],
        shadowUrl: null
    });

    var mymap = L.map('mapid').setView([46.85, 2.3518], 6);
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        minZoom: 1,
        maxZoom: 18,
    }).addTo(mymap);

    var line, animatedMarker;
    var generateLine = function(i) {
        L.marker(routes[i].route[0]).addTo(mymap);
        line = L.polyline(routes[i].route, {snakingSpeed: routes[i].speed});
        animatedMarker = L.animatedMarker(line.getLatLngs(), {
            autoStart: false,
            distance: routes[i].distance,
            interval: routes[i].interval,
            zIndexOffset: 1000,
            onEnd: function() {
                // Remove marker from map
                mymap.removeLayer(this);
            }
        });
        switch(routes[i].transportation) {
            case 'bike' :
                animatedMarker.setIcon(bikeIcon);
                break;
            case 'car' :
                animatedMarker.setIcon(carIcon);
                break;
            case 'plane' :
                animatedMarker.setIcon(planeIcon);
                break;
            case 'train' :
                animatedMarker.setIcon(trainIcon);
                break;
        }
        animatedMarker.addTo(mymap).start();
        setTimeout(function() {
            line.addTo(mymap).snakeIn()
            .on('snakeend', function() {
                if(i < routes.length - 1) {
                    generateLine(i + 1);
                }
            });
        }, 1500);
    }

    generateLine(0);

})();